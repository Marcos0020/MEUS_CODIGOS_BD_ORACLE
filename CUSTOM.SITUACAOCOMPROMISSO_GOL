CREATE OR REPLACE TRIGGER CUSTOM.SITUACAOCOMPROMISSO_GOL
AFTER UPDATE OF ID_SITUACAOCOMPROMISSO ON LDESK.JUR_COMPROMISSO
FOR EACH ROW
when (
    NEW.ID_SITUACAOCOMPROMISSO = '5FCE63D0-10C7-3B4A-30FB-4AA150A8AC50'
    AND NEW.ID_TIPOCOMPROMISSO = '5FE9E2CA-8A15-0613-5B0A-D3E4E7E7DA83'
)
DECLARE
    PRAGMA AUTONOMOUS_TRANSACTION;  -- Evita erro de trigger mutante

BEGIN

for rec0 in (SELECT id_assunto
       FROM   ldesk.jur_assunto
       WHERE   id_tipoassunto ='5FDA21D3-B241-9F3E-7CB2-17F1DA0AB41D'
       AND   id_assunto = :NEW.id_Assunto) LOOP

   --DATA DA ALTERAÇÃO +10 - TIPO DE AGENDA:JUNTADA DE GUIA - DESCRIÇÃO: JUNTADA DE GUIA
   INSERT INTO ldesk.jur_compromisso
       (DATA,
       DESCRICAO,
       DATA_INCLUSAO,
       USUARIO_INCLUSAO,
       ID_SITUACAOCOMPROMISSO,
       ID_TIPOCOMPROMISSO,
       ID_ASSUNTO,
       ID_LICENCA,
       CODIGO,
       ID_COMPROMISSO)
    VALUES (
    CUSTOM.PROXIMA_DATA_UTIL(SYSDATE + 10),
    'JUNTADA DE GUIA',
    sysdate,
    'CUSTOM',
    '5FCE638A-10C6-8E76-4B78-5E83F37B4E39',
    '5FE9E287-8A0F-6048-F3D6-20A51D0CCA69', -- JUNTADA DE GUIA
    rec0.ID_ASSUNTO,
    1,
  abs(dbms_random.random)*(-1),
    ldesk.uuid
    );
    -- Confirma a transação autônoma
    COMMIT;

   END LOOP;
END;